<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="/public/infima.css" />
    <title>Login</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body>
    <div class="container padding-top--lg">
      <h1>Bitte einloggen</h1>
      <p>Bitte logge Dich ein, um die Inhalte zu sehen.</p>
      <button type="button" class="button button--primary" id="loginWithGithub">
        Login mit GitHub
      </button>
      <button type="button" class="button button--primary" id="loginWithGoogle">
        Login mit Google
      </button>
    </div>
  </body>
  <script src="/public/pocketbase.umd.js"></script>
  <script>
    const pb = new PocketBase("https://api.xn--rssing-wxa.de/");

    const loginWithGithub = () =>
      pb
        .collection("users")
        .authWithOAuth2({ provider: "github" })
        .then(saveTokenFromAuthStoreAsCookiAndReloadPage);

    const loginWithGoogle = () =>
      pb
        .collection("users")
        .authWithOAuth2({ provider: "google" })
        .then(saveTokenFromAuthStoreAsCookiAndReloadPage);

    document.addEventListener("DOMContentLoaded", () => {
      document
        .getElementById("loginWithGoogle")
        .addEventListener("click", loginWithGoogle);
      document
        .getElementById("loginWithGithub")
        .addEventListener("click", loginWithGithub);
    });

    const saveTokenFromAuthStoreAsCookiAndReloadPage = () =>
      fetch("/api/cookie", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token: pb.authStore.token }),
      }).then(() => window.location.reload());
  </script>
</html>
